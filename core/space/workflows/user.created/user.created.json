{
  "builderVersion": "",
  "schemaVersion": "1.0",
  "version": "",
  "processOwnerEmail": "",
  "lastId": 11,
  "name": "User Created",
  "notes": "",
  "connectors": [
    {
      "from": "start",
      "to": "routine_kinetic_user_password_reset_token_create_v1_7",
      "label": "Not a kinops user",
      "value": "@user['Username'].match(/.*@kinops.io$/).nil?",
      "type": "Complete"
    },
    {
      "from": "routine_kinetic_user_password_reset_token_create_v1_7",
      "to": "smtp_email_send_v1_11",
      "label": "",
      "value": "",
      "type": "Complete"
    }
  ],
  "nodes": [
    {
      "configured": true,
      "defers": false,
      "deferrable": false,
      "visible": false,
      "name": "Start",
      "messages": [

      ],
      "dependents": {
        "task": [
          {
            "label": "Not a kinops user",
            "type": "Complete",
            "value": "@user['Username'].match(/.*@kinops.io$/).nil?",
            "content": "routine_kinetic_user_password_reset_token_create_v1_7"
          }
        ]
      },
      "id": "start",
      "position": {
        "x": 25,
        "y": 45
      },
      "version": 1,
      "parameters": [

      ],
      "definitionId": "system_start_v1"
    },
    {
      "configured": true,
      "defers": true,
      "deferrable": true,
      "visible": false,
      "name": "Generate Token",
      "messages": [

      ],
      "dependents": {
        "task": [
          {
            "label": "",
            "type": "Complete",
            "value": "",
            "content": "smtp_email_send_v1_11"
          }
        ]
      },
      "id": "routine_kinetic_user_password_reset_token_create_v1_7",
      "position": {
        "x": 283,
        "y": 53
      },
      "version": 1,
      "parameters": [
        {
          "dependsOnId": "",
          "dependsOnValue": "",
          "description": "Username of the user to create a password reset token for",
          "id": "Username",
          "label": "Username",
          "menu": "",
          "value": "<%= @user['Username']%>",
          "required": true
        }
      ],
      "definitionId": "routine_kinetic_user_password_reset_token_create_v1"
    },
    {
      "configured": true,
      "defers": false,
      "deferrable": false,
      "visible": true,
      "name": "Send Welcome Email",
      "messages": [

      ],
      "dependents": "",
      "id": "smtp_email_send_v1_11",
      "position": {
        "x": 629,
        "y": 57
      },
      "version": 1,
      "parameters": [
        {
          "dependsOnId": "",
          "dependsOnValue": "",
          "description": "Determine what to return if an error is encountered.",
          "id": "error_handling",
          "label": "Error Handling",
          "menu": "Error Message,Raise Error",
          "value": "Error Message",
          "required": true
        },
        {
          "dependsOnId": "",
          "dependsOnValue": "",
          "description": "The email address of the simulated sender.",
          "id": "from",
          "label": "From (Email Address)",
          "menu": "",
          "value": "wally@kinops.io",
          "required": true
        },
        {
          "dependsOnId": "",
          "dependsOnValue": "",
          "description": "The email address of the intended recipient.",
          "id": "to",
          "label": "To (Email Address)",
          "menu": "",
          "value": "<%= @user['Email']%>",
          "required": true
        },
        {
          "dependsOnId": "",
          "dependsOnValue": "",
          "description": "The email address of the intended recipient.",
          "id": "bcc",
          "label": "Bcc (Email Address)",
          "menu": "",
          "value": "",
          "required": false
        },
        {
          "dependsOnId": "",
          "dependsOnValue": "",
          "description": "The subject of the email.",
          "id": "subject",
          "label": "Subject",
          "menu": "",
          "value": "Welcome to kinops for <%=  @space['Name'] %>",
          "required": false
        },
        {
          "dependsOnId": "",
          "dependsOnValue": "",
          "description": "HTML representing the body of a rich email.",
          "id": "htmlbody",
          "label": "HTML Body",
          "menu": "",
          "value": "Hi <%=  @user['Display Name'] %>,<br/><br/>\n\nThanks for joining kinops.<br/><br/>\n\nYour username is: <%=  @user['Username'] %>. <br/><br/>\n\nPlease use this link to set your password: <%=\"#{@space_attributes['Web Server Url']}/#/reset-password/#{@results['Generate Token']['Password Reset Token']}?#{URI.encode_www_form(\"u\" => @user['Username'])}\"%> <br/><br/>\n\nTo login as an end user, use this url: <%=\"#{@space_attributes['Web Server Url']}\"%> <br/><br/>\n\nTo login to the admin console, use this url: <%=\"#{@space_attributes['Web Server Url']}/app\"%> <br/><br/>\n\nHappy Developing!<br/>\n\nThe Kinetic Data Team",
          "required": false
        },
        {
          "dependsOnId": "",
          "dependsOnValue": "",
          "description": "A plaintext message that will be displayed if the recipient can't display multipart HTML emails.",
          "id": "textbody",
          "label": "Alternate (text) Body",
          "menu": "",
          "value": "",
          "required": false
        }
      ],
      "definitionId": "smtp_email_send_v1"
    }
  ]
}